<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± API - Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø±Ø§Ø¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            background: #f9f9f9;
        }
        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }
        input, button {
            width: 100%;
            padding: 12px 15px;
            margin: 8px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success {
            border-color: #4caf50;
            background: #e8f5e9;
            color: #2e7d32;
        }
        .error {
            border-color: #f44336;
            background: #ffebee;
            color: #c62828;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin: 2px;
        }
        .badge-sold {
            background: #10b981;
            color: white;
        }
        .badge-available {
            background: #3b82f6;
            color: white;
        }
        .badge-haraj {
            background: #f59e0b;
            color: white;
        }
        .post-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }
        .post-card h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
        }
        .post-info {
            font-size: 12px;
            color: #666;
            margin: 5px 0;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± API - Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø±Ø§Ø¬</h1>
            <p>Ø£Ø¯Ø§Ø© Ù„ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©</p>
        </div>
        
        <div class="content">
            <!-- Section 1: API URL -->
            <div class="section">
                <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API</h2>
                <input type="text" id="apiUrl" placeholder="Ù…Ø«Ø§Ù„: https://api.example.com" value="https://cuddly-space-doodle-jjvgx7x5jqrx25p4g-3000.app.github.dev">
                <input type="text" id="token" placeholder="Ø±Ù…Ø² Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Token) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
            </div>

            <!-- Section 2: Test Posts -->
            <div class="section">
                <h2>ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h2>
                <button onclick="fetchPosts()">ğŸ”„ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</button>
                <div id="postsResult" class="result" style="display:none;"></div>
            </div>

            <!-- Section 3: Test Category -->
            <div class="section">
                <h2>ğŸ·ï¸ Ø§Ø®ØªØ¨Ø§Ø± ÙØ¦Ø© Ø§Ù„Ø­Ø±Ø§Ø¬</h2>
                <input type="text" id="category" placeholder="Ù…Ø«Ø§Ù„: Ø³ÙŠØ§Ø±Ø§Øª" value="Ø³ÙŠØ§Ø±Ø§Øª">
                <button onclick="fetchByCategory()">ğŸ” Ø¬Ù„Ø¨ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</button>
                <div id="categoryResult" class="result" style="display:none;"></div>
            </div>

            <!-- Section 4: Update Status -->
            <div class="section">
                <h2>âœï¸ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ù…Ù†Ø´ÙˆØ±</h2>
                <input type="text" id="postId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ± (Post ID)">
                <select id="newStatus" style="width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #ddd; border-radius: 8px;">
                    <option value="available">Ù…ØªØ§Ø­ (Available)</option>
                    <option value="sold">ØªÙ… Ø§Ù„Ø¨ÙŠØ¹ (Sold)</option>
                </select>
                <button onclick="updateStatus()">ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©</button>
                <div id="updateResult" class="result" style="display:none;"></div>
            </div>

            <!-- Section 5: Check Specific Post -->
            <div class="section">
                <h2>ğŸ” ÙØ­Øµ Ù…Ù†Ø´ÙˆØ± Ù…Ø­Ø¯Ø¯</h2>
                <input type="text" id="checkPostId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±">
                <button onclick="checkPost()">âœ“ ÙØ­Øµ</button>
                <div id="checkResult" class="result" style="display:none;"></div>
            </div>
        </div>
    </div>

    <script>
        const HARAJ_CATEGORIES = [
            'Ø³ÙŠØ§Ø±Ø§Øª', 'Ø¹Ù‚Ø§Ø±Ø§Øª', 'Ø£Ø¬Ù‡Ø²Ø© Ù…Ù†Ø²Ù„ÙŠØ©', 'Ø£Ø«Ø§Ø« ÙˆÙ…ÙØ±ÙˆØ´Ø§Øª',
            'Ø¬ÙˆØ§Ù„Ø§Øª', 'Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª ÙˆÙƒÙ…Ø¨ÙŠÙˆØªØ±', 'ÙƒØ§Ù…ÙŠØ±Ø§Øª ÙˆØªØµÙˆÙŠØ±', 'Ø£Ù„Ø¹Ø§Ø¨ ÙÙŠØ¯ÙŠÙˆ',
            'Ù…Ù„Ø§Ø¨Ø³ ÙˆÙ…ÙˆØ¶Ø©', 'Ø³Ø§Ø¹Ø§Øª ÙˆÙ…Ø¬ÙˆÙ‡Ø±Ø§Øª', 'Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø£Ù„ÙŠÙØ©', 'Ø·ÙŠÙˆØ±',
            'Ù…Ø¹Ø¯Ø§Øª Ø«Ù‚ÙŠÙ„Ø©', 'Ù‚Ø·Ø¹ ØºÙŠØ§Ø±', 'ØªØ­Ù ÙˆÙ…Ù‚ØªÙ†ÙŠØ§Øª', 'ÙƒØªØ¨ ÙˆÙ…Ø¬Ù„Ø§Øª',
            'Ø£Ø¯ÙˆØ§Øª Ø±ÙŠØ§Ø¶ÙŠØ©', 'Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø£Ø·ÙØ§Ù„', 'Ø®ÙŠÙ… ÙˆØªØ®ÙŠÙŠÙ…', 'Ø£Ø±Ù‚Ø§Ù… Ù…Ù…ÙŠØ²Ø©',
            'Ù†Ù‚Ù„ Ø¹ÙØ´', 'Ø£Ø¯ÙˆØ§Øª Ø£Ø®Ø±Ù‰'
        ];

        function getHeaders() {
            const token = document.getElementById('token').value;
            const headers = { 'Content-Type': 'application/json' };
            if (token) headers['Authorization'] = `Bearer ${token}`;
            return headers;
        }

        function getApiUrl() {
            return document.getElementById('apiUrl').value.replace(/\/$/, '');
        }

        function showLoading(elementId) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.className = 'result';
            el.innerHTML = '<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>';
        }

        function showResult(elementId, data, isError = false) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.className = isError ? 'result error' : 'result success';
            el.textContent = JSON.stringify(data, null, 2);
        }

        function isHarajPost(post) {
            if (post.type === 'haraj') return true;
            return post.category && HARAJ_CATEGORIES.includes(post.category);
        }

        function renderPost(post) {
            const isHaraj = isHarajPost(post);
            const badges = [];
            
            if (isHaraj) badges.push('<span class="badge badge-haraj">Ø­Ø±Ø§Ø¬</span>');
            if (post.harajStatus === 'sold') badges.push('<span class="badge badge-sold">ØªÙ… Ø§Ù„Ø¨ÙŠØ¹ âœ“</span>');
            if (post.harajStatus === 'available') badges.push('<span class="badge badge-available">Ù…ØªØ§Ø­</span>');

            return `
                <div class="post-card">
                    <h3>${post.text || post.content || 'Ø¨Ø¯ÙˆÙ† Ù†Øµ'}</h3>
                    <div class="post-info">
                        <strong>ID:</strong> ${post._id || post.id}<br>
                        <strong>Category:</strong> ${post.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                        <strong>Type:</strong> ${post.type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                        <strong>Haraj Status:</strong> ${post.harajStatus || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                        <strong>Is Haraj?</strong> ${isHaraj ? 'âœ“ Ù†Ø¹Ù…' : 'âœ— Ù„Ø§'}
                    </div>
                    <div style="margin-top: 10px;">${badges.join(' ')}</div>
                    ${!post.harajStatus && isHaraj ? '<p style="color: red; margin-top: 10px;">âš ï¸ ØªØ­Ø°ÙŠØ±: Ù…Ù†Ø´ÙˆØ± Ø­Ø±Ø§Ø¬ Ø¨Ø¯ÙˆÙ† harajStatus!</p>' : ''}
                    ${post.type !== 'haraj' && isHaraj ? '<p style="color: orange; margin-top: 10px;">âš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ù„ÙØ¦Ø© Ø­Ø±Ø§Ø¬ Ù„ÙƒÙ† type Ù„ÙŠØ³ haraj!</p>' : ''}
                </div>
            `;
        }

        async function fetchPosts() {
            showLoading('postsResult');
            try {
                const response = await fetch(`${getApiUrl()}/api/v1/posts`, {
                    headers: getHeaders()
                });
                const data = await response.json();
                
                const el = document.getElementById('postsResult');
                el.style.display = 'block';
                el.className = 'result success';
                
                const posts = data.posts || data;
                if (!Array.isArray(posts) || posts.length === 0) {
                    el.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª</p>';
                    return;
                }

                let html = `<h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª: ${posts.length}</h3>`;
                const harajPosts = posts.filter(isHarajPost);
                const soldPosts = harajPosts.filter(p => p.harajStatus === 'sold');
                
                html += `<p><strong>Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø¬:</strong> ${harajPosts.length}</p>`;
                html += `<p><strong>ØªÙ… Ø¨ÙŠØ¹Ù‡Ø§:</strong> ${soldPosts.length}</p><hr>`;
                
                posts.slice(0, 10).forEach(post => {
                    html += renderPost(post);
                });

                if (posts.length > 10) {
                    html += `<p style="text-align: center; color: #999; margin-top: 15px;">... Ùˆ ${posts.length - 10} Ù…Ù†Ø´ÙˆØ± Ø¢Ø®Ø±</p>`;
                }

                el.innerHTML = html;
            } catch (error) {
                showResult('postsResult', { error: error.message }, true);
            }
        }

        async function fetchByCategory() {
            const category = document.getElementById('category').value;
            showLoading('categoryResult');
            try {
                const response = await fetch(`${getApiUrl()}/api/v1/posts?category=${encodeURIComponent(category)}`, {
                    headers: getHeaders()
                });
                const data = await response.json();
                
                const el = document.getElementById('categoryResult');
                el.style.display = 'block';
                el.className = 'result success';
                
                const posts = data.posts || data;
                if (!Array.isArray(posts) || posts.length === 0) {
                    el.innerHTML = `<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙÙŠ ÙØ¦Ø© "${category}"</p>`;
                    return;
                }

                let html = `<h3>ÙØ¦Ø©: ${category} (${posts.length} Ù…Ù†Ø´ÙˆØ±)</h3><hr>`;
                posts.forEach(post => {
                    html += renderPost(post);
                });

                el.innerHTML = html;
            } catch (error) {
                showResult('categoryResult', { error: error.message }, true);
            }
        }

        async function updateStatus() {
            const postId = document.getElementById('postId').value;
            const status = document.getElementById('newStatus').value;
            
            if (!postId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±');
                return;
            }

            showLoading('updateResult');
            try {
                const response = await fetch(`${getApiUrl()}/api/v1/posts/${postId}/haraj-status`, {
                    method: 'PUT',
                    headers: getHeaders(),
                    body: JSON.stringify({ status })
                });
                const data = await response.json();
                showResult('updateResult', data, !response.ok);
            } catch (error) {
                showResult('updateResult', { error: error.message }, true);
            }
        }

        async function checkPost() {
            const postId = document.getElementById('checkPostId').value;
            
            if (!postId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±');
                return;
            }

            showLoading('checkResult');
            try {
                const response = await fetch(`${getApiUrl()}/api/v1/posts/${postId}`, {
                    headers: getHeaders()
                });
                const data = await response.json();
                
                const el = document.getElementById('checkResult');
                el.style.display = 'block';
                el.className = 'result success';
                
                const post = data.post || data;
                el.innerHTML = renderPost(post);
            } catch (error) {
                showResult('checkResult', { error: error.message }, true);
            }
        }

        // Auto-load posts on page load
        window.onload = () => {
            console.log('ğŸ” Ø£Ø¯Ø§Ø© Ø§Ø®ØªØ¨Ø§Ø± API Ø¬Ø§Ù‡Ø²Ø©');
            console.log('ğŸ“‹ ÙØ¦Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø¬:', HARAJ_CATEGORIES);
        };
    </script>
</body>
</html>
